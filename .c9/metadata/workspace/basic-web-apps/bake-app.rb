{"changed":true,"filter":false,"title":"bake-app.rb","tooltip":"/basic-web-apps/bake-app.rb","value":"require \"sinatra\"     # Load the Sinatra web framework\nrequire \"data_mapper\" # Load the DataMapper database library\n\nrequire \"./database_setup\"\n\nclass Message\n  include DataMapper::Resource\n\n  property :id,         Serial\n  property :body,       Text,     required: true\n  property :upvotes,    Integer,  required: true, default: 0\n  property :downvotes,  Integer,  required:true,  default: 0\n  property :shown,      Integer,  required: true, default: 0\n  property :created_at, DateTime, required: true\n  \nend\n\nDataMapper.finalize()\nDataMapper.auto_upgrade!()\n\nget(\"/\") do\n  records = Message.all(order: :created_at.desc)\n  erb(:index, locals: { messages: records })\nend\n\npost(\"/messages\") do\n  message_body = params[\"body\"]\n  message_time = DateTime.now\n\n  message = Message.create(body: message_body, created_at: message_time)\n\n  if message.saved?\n    redirect(\"/\")\n  else\n    erb(:error)\n  end\nend\n\npost(\"/messages/*/upvote\") do |message_id|\n  message = Message.get(message_id)\n  message.upvotes = message.upvotes + 1\n\n  if message.save\n    redirect(\"/\")\n  else\n    body(\"Error\")\n  end\nend\n\npost(\"/messages/*/downvote\") do |message_id|\n  message = Message.get(message_id)\n  message.downvotes = message.downvotes + 1\n\n  if message.save\n    redirect(\"/\")\n  else\n    body(\"Error\")\n  end\nend\n\npost(\"/messages/*/delete\") do |message_id|\n  message = Message.get(message_id)\n  puts message_id\n  message.shown = 1\n  \nend\n  \n  \nget(\"/waffles\") do\n  html = \"\"\n\n  html.concat(\"<img src='http://upload.wikimedia.org/wikipedia/commons/5/5b/Waffles_with_Strawberries.jpg' height='800'>\")\n\n  erb(:content, { locals: { content: html } })\nend\n\nget(\"/waffles/chocolate\") do\n  html = \"\"\n\n  html.concat(\"<h2>We're out.</h2>\")\n  html.concat(\"<p>Sorry.</p>\")\n\n  erb(:content, { locals: { content: html } })\nend\n\n# Visit, e.g., /bake?baked_good=waffles&count=20\n\nget(\"/bake\") do\n  count      = Integer(params[\"count\"])\n  baked_good = String(params[\"baked_good\"])\n\n  html = \"Baking #{count} #{baked_good}...\"\n  html.concat(\"<ul>\")\n  count.times do |num|\n    num=num+1\n    html.concat(\"<li>#{baked_good} number #{num}</li>\")\n  end\n  html.concat(\"</ul>\")\n\n  erb(:content, { locals: { content: html } })\nend\n\nget(\"/lets_bake\") do\n\n  html = \"\"\n  html = \"What do you want to bake?\"\n  html.concat(\"<li><a href='/bake?baked_good=cookies&count=100'>bake 100 cookies</a></li>\")\n  html.concat(\"<li><a href='/bake?baked_good=cronut&count=500'>bake 500 cronuts</a></li>\")\n  html.concat(\"<li><a href='/bake?baked_good=bread&count=2500'>bake 2500 loaves of bread</a></li>\")\n  html.concat(\"<li><a href='/suggestions'>I don't know what I want to bake.</a></li>\")\n \n  erb(:content, { locals: { content: html } })\nend\n\nget(\"/suggestions\") do\n\n  file_contents = File.readlines(\"message-of-the-day.txt\").sample\n\n  html = \"\"\n  html.concat(\"<h1>Is that so?</h1>\")\n  html.concat(\"<p>How about <a href='/bake?baked_good=#{file_contents}s&count=100'>#{file_contents}</a>?\")\n  html.concat(\"<p><a href='/suggestions'>No, something else.</a>\")\n\n  body(html)\n  erb(:content, { locals: { content: html } })\nend","undoManager":{"mark":98,"position":100,"stack":[[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":12,"column":22},"end":{"row":12,"column":24}},"text":"  "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":12,"column":33},"end":{"row":12,"column":34}},"text":" "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":12,"column":58},"end":{"row":12,"column":59}},"text":" "}]}],[{"group":"doc","deltas":[{"action":"removeLines","range":{"start":{"row":61,"column":0},"end":{"row":62,"column":0}},"nl":"\n","lines":["end"]}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":61,"column":0},"end":{"row":61,"column":2}},"text":"  "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":61,"column":2},"end":{"row":62,"column":0}},"text":"\n"},{"action":"insertText","range":{"start":{"row":62,"column":0},"end":{"row":62,"column":2}},"text":"  "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":60,"column":26},"end":{"row":60,"column":27}},"text":" "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":60,"column":27},"end":{"row":60,"column":28}},"text":"d"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":60,"column":28},"end":{"row":60,"column":29}},"text":"o"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":60,"column":29},"end":{"row":60,"column":30}},"text":" "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":60,"column":30},"end":{"row":60,"column":31}},"text":"|"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":60,"column":31},"end":{"row":60,"column":32}},"text":"m"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":60,"column":32},"end":{"row":60,"column":33}},"text":"e"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":60,"column":33},"end":{"row":60,"column":34}},"text":"s"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":60,"column":31},"end":{"row":60,"column":34}},"text":"mes"},{"action":"insertText","range":{"start":{"row":60,"column":31},"end":{"row":60,"column":41}},"text":"message_id"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":60,"column":41},"end":{"row":60,"column":42}},"text":"|"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":60,"column":42},"end":{"row":61,"column":0}},"text":"\n"},{"action":"insertText","range":{"start":{"row":61,"column":0},"end":{"row":61,"column":2}},"text":"  "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":61,"column":2},"end":{"row":61,"column":3}},"text":"e"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":61,"column":3},"end":{"row":61,"column":4}},"text":"n"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":61,"column":4},"end":{"row":61,"column":5}},"text":"d"},{"action":"removeText","range":{"start":{"row":61,"column":0},"end":{"row":61,"column":2}},"text":"  "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":60,"column":42},"end":{"row":61,"column":0}},"text":"\n"},{"action":"insertText","range":{"start":{"row":61,"column":0},"end":{"row":61,"column":2}},"text":"  "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":61,"column":2},"end":{"row":61,"column":35}},"text":"message = Message.get(message_id)"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":61,"column":35},"end":{"row":62,"column":0}},"text":"\n"},{"action":"insertText","range":{"start":{"row":62,"column":0},"end":{"row":62,"column":2}},"text":"  "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":62,"column":2},"end":{"row":62,"column":3}},"text":"s"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":62,"column":3},"end":{"row":62,"column":4}},"text":"h"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":62,"column":3},"end":{"row":62,"column":4}},"text":"h"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":62,"column":2},"end":{"row":62,"column":3}},"text":"s"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":62,"column":2},"end":{"row":62,"column":3}},"text":"m"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":62,"column":2},"end":{"row":62,"column":3}},"text":"m"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":62,"column":2},"end":{"row":62,"column":3}},"text":"m"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":62,"column":2},"end":{"row":62,"column":3}},"text":"m"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":62,"column":2},"end":{"row":62,"column":3}},"text":"s"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":62,"column":3},"end":{"row":62,"column":4}},"text":"h"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":62,"column":4},"end":{"row":62,"column":5}},"text":"o"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":62,"column":5},"end":{"row":62,"column":6}},"text":"w"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":62,"column":6},"end":{"row":62,"column":7}},"text":"n"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":62,"column":6},"end":{"row":62,"column":7}},"text":"n"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":62,"column":5},"end":{"row":62,"column":6}},"text":"w"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":62,"column":4},"end":{"row":62,"column":5}},"text":"o"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":62,"column":3},"end":{"row":62,"column":4}},"text":"h"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":62,"column":2},"end":{"row":62,"column":3}},"text":"s"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":62,"column":2},"end":{"row":62,"column":3}},"text":"m"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":62,"column":3},"end":{"row":62,"column":4}},"text":"e"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":62,"column":4},"end":{"row":62,"column":5}},"text":"s"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":62,"column":5},"end":{"row":62,"column":6}},"text":"s"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":62,"column":6},"end":{"row":62,"column":7}},"text":"a"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":62,"column":7},"end":{"row":62,"column":8}},"text":"g"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":62,"column":8},"end":{"row":62,"column":9}},"text":"e"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":62,"column":9},"end":{"row":62,"column":10}},"text":"."}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":62,"column":10},"end":{"row":62,"column":11}},"text":"S"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":62,"column":10},"end":{"row":62,"column":11}},"text":"S"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":62,"column":10},"end":{"row":62,"column":11}},"text":"s"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":62,"column":11},"end":{"row":62,"column":12}},"text":"h"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":62,"column":12},"end":{"row":62,"column":13}},"text":"o"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":62,"column":13},"end":{"row":62,"column":14}},"text":"w"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":62,"column":14},"end":{"row":62,"column":15}},"text":"n"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":62,"column":15},"end":{"row":62,"column":16}},"text":" "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":62,"column":16},"end":{"row":62,"column":17}},"text":"="}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":62,"column":17},"end":{"row":62,"column":18}},"text":" "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":62,"column":18},"end":{"row":62,"column":19}},"text":"1"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":62,"column":19},"end":{"row":63,"column":0}},"text":"\n"},{"action":"insertText","range":{"start":{"row":63,"column":0},"end":{"row":63,"column":2}},"text":"  "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":63,"column":2},"end":{"row":64,"column":0}},"text":"\n"},{"action":"insertText","range":{"start":{"row":64,"column":0},"end":{"row":64,"column":2}},"text":"  "}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":64,"column":0},"end":{"row":64,"column":2}},"text":"  "}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":63,"column":2},"end":{"row":64,"column":0}},"text":"\n"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":61,"column":35},"end":{"row":62,"column":0}},"text":"\n"},{"action":"insertText","range":{"start":{"row":62,"column":0},"end":{"row":62,"column":2}},"text":"  "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":62,"column":2},"end":{"row":62,"column":3}},"text":"p"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":62,"column":3},"end":{"row":62,"column":4}},"text":"u"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":62,"column":4},"end":{"row":62,"column":5}},"text":"t"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":62,"column":5},"end":{"row":62,"column":6}},"text":"s"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":62,"column":6},"end":{"row":62,"column":7}},"text":"m"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":62,"column":6},"end":{"row":62,"column":7}},"text":"m"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":62,"column":6},"end":{"row":62,"column":7}},"text":" "}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":62,"column":6},"end":{"row":62,"column":7}},"text":" "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":62,"column":6},"end":{"row":62,"column":7}},"text":" "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":62,"column":7},"end":{"row":62,"column":8}},"text":"M"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":62,"column":8},"end":{"row":62,"column":9}},"text":"e"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":62,"column":9},"end":{"row":62,"column":10}},"text":"s"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":62,"column":10},"end":{"row":62,"column":11}},"text":"s"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":62,"column":11},"end":{"row":62,"column":12}},"text":"a"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":62,"column":12},"end":{"row":62,"column":13}},"text":"g"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":62,"column":13},"end":{"row":62,"column":14}},"text":"e"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":62,"column":14},"end":{"row":62,"column":15}},"text":"."}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":62,"column":15},"end":{"row":62,"column":16}},"text":"b"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":62,"column":16},"end":{"row":62,"column":17}},"text":"o"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":62,"column":17},"end":{"row":62,"column":18}},"text":"d"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":62,"column":18},"end":{"row":62,"column":19}},"text":"y"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":62,"column":7},"end":{"row":62,"column":8}},"text":"M"},{"action":"insertText","range":{"start":{"row":62,"column":7},"end":{"row":62,"column":8}},"text":"m"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":62,"column":18},"end":{"row":62,"column":19}},"text":"y"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":62,"column":17},"end":{"row":62,"column":18}},"text":"d"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":62,"column":16},"end":{"row":62,"column":17}},"text":"o"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":62,"column":15},"end":{"row":62,"column":16}},"text":"b"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":62,"column":14},"end":{"row":62,"column":15}},"text":"."}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":62,"column":14},"end":{"row":62,"column":15}},"text":"_"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":62,"column":15},"end":{"row":62,"column":16}},"text":"I"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":62,"column":16},"end":{"row":62,"column":17}},"text":"d"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":62,"column":16},"end":{"row":62,"column":17}},"text":"d"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":62,"column":15},"end":{"row":62,"column":16}},"text":"I"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":62,"column":15},"end":{"row":62,"column":16}},"text":"i"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":62,"column":16},"end":{"row":62,"column":17}},"text":"d"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":62,"column":17},"end":{"row":62,"column":18}},"text":"$"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":62,"column":17},"end":{"row":62,"column":18}},"text":"$"}]}]]},"ace":{"folds":[],"scrolltop":760.5,"scrollleft":0,"selection":{"start":{"row":62,"column":17},"end":{"row":62,"column":17},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":46,"state":"start","mode":"ace/mode/ruby"}},"timestamp":1412723975555}